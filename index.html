<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Researcher's Vault - Master Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/marked/marked.min.js"></script>
    
    <style>
        mark { background-color: #fde047; color: #1e293b; padding: 0 2px; border-radius: 2px; }
        .dark mark { background-color: #854d0e; color: #fefce8; }
        @media print {
            body { background: white !important; color: black !important; font-family: serif; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .note-card { break-inside: avoid; border-bottom: 1px solid #ddd !important; margin-bottom: 2rem !important; }
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 transition-colors">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const templates = {
            blank: "",
            cornell: "### Cues / Questions\n- \n\n### Notes\n- \n\n### Summary\n- ",
            zettel: "### Atomic Idea\n- \n\n### Connection to [Topic]\n- \n\n### Source Reference\n- ",
            review: "### Main Argument\n- \n\n### Key Evidence\n- \n\n### Personal Critique\n- "
        };

        const App = () => {
            const [notes, setNotes] = useState([]);
            const [darkMode, setDarkMode] = useState(false);
            const [query, setQuery] = useState('');
            const [newNote, setNewNote] = useState({ title: '', author: '', content: '', tags: '' });

            useEffect(() => {
                const saved = localStorage.getItem('vault_master_final');
                if (saved) setNotes(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('vault_master_final', JSON.stringify(notes));
            }, [notes]);

            const handleTemplateChange = (e) => {
                const selected = e.target.value;
                if (selected !== "blank") {
                    setNewNote({ ...newNote, content: templates[selected] });
                }
            };

            const handleAdd = (e) => {
                e.preventDefault();
                if (!newNote.title || !newNote.content) return;
                const noteToAdd = { 
                    ...newNote, 
                    id: Date.now(), 
                    dateAdded: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) 
                };
                setNotes([noteToAdd, ...notes]);
                setNewNote({ title: '', author: '', content: '', tags: '' });
                document.getElementById('template-select').value = "blank";
            };

            const filteredNotes = notes.filter(n => 
                n.title.toLowerCase().includes(query.toLowerCase()) || 
                n.content.toLowerCase().includes(query.toLowerCase())
            );

            return (
                <div className={darkMode ? 'dark' : ''}>
                    <div className="min-h-screen p-4 md:p-8 dark:bg-slate-900">
                        <div className="max-w-4xl mx-auto">
                            <header className="flex justify-between items-center mb-8 no-print">
                                <h1 className="text-2xl font-black dark:text-white uppercase italic italic underline decoration-indigo-500">The Vault</h1>
                                <button onClick={() => setDarkMode(!darkMode)} className="p-2 border rounded-full dark:text-white border-slate-200 dark:border-slate-700">{darkMode ? '‚òÄÔ∏è' : 'üåô'}</button>
                            </header>

                            <section className="bg-white dark:bg-slate-800 p-6 rounded-2xl shadow-xl mb-8 border dark:border-slate-700 no-print">
                                <form onSubmit={handleAdd} className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <input placeholder="Book Title" className="bg-transparent border-b dark:border-slate-600 dark:text-white p-2 outline-none focus:border-indigo-500" value={newNote.title} onChange={e => setNewNote({...newNote, title: e.target.value})} />
                                        <select id="template-select" onChange={handleTemplateChange} className="bg-transparent border-b dark:border-slate-600 dark:text-slate-400 p-2 outline-none cursor-pointer">
                                            <option value="blank">Choose Template...</option>
                                            <option value="cornell">Cornell Method</option>
                                            <option value="zettel">Zettelkasten (Atomic)</option>
                                            <option value="review">Book Review</option>
                                        </select>
                                    </div>
                                    <textarea id="editor" placeholder="Start typing..." className="w-full h-48 bg-slate-50 dark:bg-slate-900 p-4 rounded-xl dark:text-white outline-none focus:ring-2 ring-indigo-500 font-mono text-sm" value={newNote.content} onChange={e => setNewNote({...newNote, content: e.target.value})} />
                                    <button className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-indigo-700 transition">Save Note</button>
                                </form>
                            </section>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                {filteredNotes.map(n => (
                                    <div key={n.id} className="note-card bg-white dark:bg-slate-800 p-6 rounded-2xl border dark:border-slate-700 shadow-sm relative">
                                        <h2 className="text-xl font-black dark:text-white mb-4 leading-tight">{n.title}</h2>
                                        <div className="prose prose-sm dark:prose-invert text-slate-700 dark:text-slate-300 mb-4 whitespace-pre-wrap" dangerouslySetInnerHTML={{ __html: marked.parse(n.content) }} />
                                        <div className="text-[10px] text-slate-400 uppercase tracking-widest font-bold">Captured {n.dateAdded}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>